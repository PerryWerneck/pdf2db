<?xml version="1.0" encoding="UTF-8" ?>
<!--

	Declaração do parser para exame.

-->

<pdf2db>

	<document-parser name='Hematócrito'>

		<filter page='1' line='1' type='text' value='^Clínica Prontovet' />
		<filter page='1' line='4' type='text' value='^Hematócrito' />

		<!-- Informações do tutor -->
		<property name='tutor' type='regex' page='1' line='9' expression='(.*)-.*'>
		</property>

		<property name='nametutor' type='regex' page='1' line='9' expression='.*-(.*)'>
		</property>

		<sql name='idtutor'>
			INSERT
				INTO `tutor`
					(`identificacao`,`name`)
				VALUES
					(${tutor}, ${nametutor})
				ON DUPLICATE KEY UPDATE
					idtutor=LAST_INSERT_ID(idtutor);
		</sql>

		<!-- Informações para atualização de tabelas -->

		<property name='especie' type='regex' page='1' expression='^Espécie:(.*)Sexo.*'>
		</property>

		<sql name='idespecie' >
			INSERT
				INTO `especie`
					(`name`)
				VALUES
					(lower(${especie}))
				ON DUPLICATE KEY UPDATE
					idespecie=LAST_INSERT_ID(idespecie);
		</sql>

		<property name='raca' type='regex' page='1' expression='^Raça:(.*)Idade.*'>
		</property>

		<sql name='idraca'>
			INSERT
				INTO `raca`
					(`description`)
				VALUES
					(lower(${raca}))
				ON DUPLICATE KEY UPDATE
					idraca=LAST_INSERT_ID(idraca);
		</sql>

		<!-- Informações do animal -->
		<property name='animal' type='regex' page='1' expression='^Animal:(.*)-.*'>
		</property>

		<property name='genero' type='regex' page='1' expression='.*Sexo:(.*)$'>
		</property>

		<property name='nomeanimal' type='regex' page='1' expression='^Animal:.*-(.*)Peso.*'>
		</property>

		<sql name='idanimal'>
			INSERT
				INTO `animal`
					(`idtutor`, `idespecie`, `idraca`, `identificacao`, `name`, `genero`)
				VALUES (
					${idtutor},
					${idespecie},
					${idraca},
					${animal},
					lower(${nomeanimal}),
					lower(${genero})
				)
				ON DUPLICATE KEY UPDATE
					idanimal=LAST_INSERT_ID(idanimal);
		</sql>

		<!-- Dados do exame -->

		<property name='conclusoes' type='text-block' page='1' begin='^Conclusões$' end='^Exame realizado o dia.*'>
		</property>

		<property name='dataexame' type='regex' page='1' expression='^Exame realizado.*([0-9][0-9]/[0-9][0-9]/[0-9][0-9][0-9][0-9]).'>
		</property>

		<property name='horaexame' type='regex' page='1' expression='^Horário.*([0-9][0-9]:[0-9][0-9])'>
		</property>

		<property name='test-5chars' type='text' page='1' line='1' line-length='5'>
		</property>

		<property name='test2-from5' type='text' page='1' line='1' start-char='5'>
		</property>

		<property name='test2-4' type='text' page='1' line='1' start-char='2' line-length='3'>
		</property>

		<!-- Resultados do exame ficam num parser menor que só processa um bloco do documento -->
		<document-itens page='1' begin='^Resultado$' end='^Horário.*'>

			<!-- Descrição está nas primeiras 40 colunas -->
			<property name='description' type='text' start-char='1' line-length='40'/>

			<!-- property name='value' type='number' start-char='41' decimal-point=','/ -->

<!--
xxxxxxxxx.xxxxxxxxx.xxxxxxxxx.xxxxxxxxx.xxxxxxxxx.xxxxxxxxx.
Hematócrito                                                            22 %
Proteínas Totais Plasmáticas                                        6,0 mg/dL
-->

		</document-itens>

	</document-parser>


</pdf2db>
